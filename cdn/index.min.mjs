const XIN_PATH=Symbol("xin-path"),XIN_VALUE=Symbol("xin-value"),settings={debug:!1,perf:!1},observerShouldBeRemoved=Symbol("observer should be removed"),listeners=[],touchedPaths=[];let updateTriggered=!1,resolveUpdate;const getPath=e=>"object"==typeof e?e[XIN_PATH]:e;class Listener{constructor(t,e){var n="string"==typeof e?`"${e}"`:"function "+e.name;let r;if("string"==typeof t)this.test=e=>"string"==typeof e&&""!==e&&(t.startsWith(e)||e.startsWith(t)),r=`test = "${t}"`;else if(t instanceof RegExp)this.test=t.test.bind(t),r=`test = "${t.toString()}"`;else{if(!(t instanceof Function))throw new Error("expect listener test to be a string, RegExp, or test function");this.test=t,r="test = function "+t.name}if(this.description=r+", "+n,"function"!=typeof e)throw new Error("expect callback to be a path or function");this.callback=e,listeners.push(this)}}const update=()=>{settings.perf&&console.time("xin async update");for(const n of[...touchedPaths])listeners.filter(t=>{let e;try{e=t.test(n)}catch(e){throw new Error(`Listener ${t.description} threw "${e}" at "${n}"`)}return e===observerShouldBeRemoved?(unobserve(t),!1):e}).forEach(t=>{let e;try{e=t.callback(n)}catch(e){console.error(`Listener ${t.description} threw "${e}" handling "${n}"`)}e===observerShouldBeRemoved&&unobserve(t)});touchedPaths.splice(0),updateTriggered=!1,"function"==typeof resolveUpdate&&resolveUpdate(),settings.perf&&console.timeEnd("xin async update")},touch=e=>{const t=getPath(e);!1===updateTriggered&&(new Promise(e=>{resolveUpdate=e}),updateTriggered=setTimeout(update)),null==touchedPaths.find(e=>t.startsWith(e))&&touchedPaths.push(t)},observe$1=(e,t)=>new Listener(e,t),unobserve=e=>{e=listeners.indexOf(e);if(!(-1<e))throw new Error("unobserve failed, listener not found");listeners.splice(e,1)},stringify=e=>{try{return JSON.stringify(e)}catch(e){return"{has circular references}"}},makeError=(...e)=>new Error(e.map(stringify).join(" ")),now36=()=>new Date(parseInt("1000000000",36)+Date.now()).valueOf().toString(36).slice(1);let _seq=0;const seq=()=>(parseInt("10000",36)+ ++_seq).toString(36).slice(-5),id=()=>now36()+seq(),_delete_={},_newObject_={};function pathParts(t){if(""===t)return[];if(Array.isArray(t))return t;for(var n=[];0<t.length;){let e=t.search(/\[[^\]]+\]/);if(-1===e){n.push(t.split("."));break}var r=t.slice(0,e);t=t.slice(e),""!==r&&n.push(r.split(".")),e=t.indexOf("]")+1,n.push(t.slice(1,e-1)),"."===t.slice(e,e+1)&&(e+=1),t=t.slice(e)}return n}const idPathMaps=new WeakMap;function buildIdPathValueMap(e,n){void 0===idPathMaps.get(e)&&idPathMaps.set(e,{}),void 0===idPathMaps.get(e)[n]&&(idPathMaps.get(e)[n]={});const r=idPathMaps.get(e)[n];return"_auto_"===n?e.forEach((e,t)=>{void 0===e._auto_&&(e._auto_=id()),r[e._auto_+""]=t}):e.forEach((e,t)=>{r[getByPath(e,n)+""]=t}),r}function getIdPathMap(e,t){return void 0===idPathMaps.get(e)||void 0===idPathMaps.get(e)[t]?buildIdPathValueMap(e,t):idPathMaps.get(e)[t]}function keyToIndex(e,t,n){n+="";let r=getIdPathMap(e,t)[n];return r=void 0!==r&&getByPath(e[r],t)+""===n?r:buildIdPathValueMap(e,t)[n]}function byKey(e,t,n){return void 0===e[t]&&void 0!==n&&(e[t]=n),e[t]}function byIdPath(e,t,n,r){let i=""!==t?keyToIndex(e,t,n):n;if(r===_delete_)return e.splice(i,1),idPathMaps.delete(e),Symbol("deleted");if(r===_newObject_)""===t&&void 0===e[i]&&(e[i]={});else if(void 0!==r)if(void 0!==i)e[i]=r;else{if(""===t||getByPath(r,t)+""!=n+"")throw new Error(`byIdPath insert failed at [${t}=${n}]`);e.push(r),i=e.length-1}return e[i]}function expectArray(e){if(!Array.isArray(e))throw makeError("setByPath failed: expected array, found",e)}function expectObject(e){if(null==e||e.constructor!==Object)throw makeError("setByPath failed: expected Object, found",e)}function getByPath(e,t){var n=pathParts(t);let r=e,i,o,s,l;for(i=0,o=n.length;void 0!==r&&i<o;i++){var a,h,u=n[i];if(Array.isArray(u))for(s=0,l=u.length;void 0!==r&&s<l;s++){var d=u[s];r=r[d]}else if(0===r.length){if(r=r[u.slice(1)],"="!==u[0])return}else r=u.includes("=")?([a,...h]=u.split("="),byIdPath(r,a,h.join("="))):(s=parseInt(u,10),r[s])}return r}function setByPath(e,t,n){let r=e;for(var i=pathParts(t);null!=r&&0<i.length;){var o=i.shift();if("string"==typeof o){var s=o.indexOf("=");if(-1<s){(0===s?expectObject:expectArray)(r);var l=o.slice(0,s),s=o.slice(s+1);if(r=byIdPath(r,l,s,0<i.length?_newObject_:n),0===i.length)return!0}else{expectArray(r);l=parseInt(o,10);if(!(0<i.length)){if(n!==_delete_){if(r[l]===n)return!1;r[l]=n}else r.splice(l,1);return!0}r=r[l]}}else{if(!(Array.isArray(o)&&0<o.length))throw new Error("setByPath failed, bad path "+t);for(expectObject(r);0<o.length;){var a=o.shift();if(!(0<o.length||0<i.length)){if(n!==_delete_){if(r[a]===n)return!1;r[a]=n}else{if(!Object.prototype.hasOwnProperty.call(r,a))return!1;delete r[a]}return!0}r=byKey(r,a,0<o.length?{}:[])}}}throw new Error(`setByPath(${e}, ${t}, ${n}) failed`)}const ARRAY_MUTATIONS=["sort","splice","copyWithin","fill","pop","push","reverse","shift","unshift"],registry={},validPath=/^\.?([^.[\](),])+(\.[^.[\](),]+|\[\d+\]|\[[^=[\](),]*=[^[\]()]+\])*$/,isValidPath=e=>validPath.test(e),extendPath=(e="",t="")=>""===e?t:null!==t.match(/^\d+$/)||t.includes("=")?e+`[${t}]`:e+"."+t,regHandler=(l="")=>({get(t,e){if(e===XIN_PATH)return l;if(e===XIN_VALUE)return t;if("symbol"==typeof e)return t[e];let n=e;var r,i,e=n.match(/^([^.[]+)\.(.+)$/)??n.match(/^([^\]]+)(\[.+)/)??n.match(/^(\[[^\]]+\])\.(.+)$/)??n.match(/^(\[[^\]]+\])\[(.+)$/);if(null!==e)return[,e,r]=e,i=extendPath(l,e),null!==(e=getByPath(t,e))&&"object"==typeof e?new Proxy(e,regHandler(i))[r]:e;if(n.startsWith("[")&&n.endsWith("]")&&(n=n.substring(1,n.length-1)),!Array.isArray(t)&&void 0!==t[n]||Array.isArray(t)&&n.includes("=")){let e;if(n.includes("=")){const[o,s]=n.split("=");e=t.find(e=>""+getByPath(e,o)===s)}else e=t[n];return null!==e&&"object"==typeof e?(i=extendPath(l,n),new Proxy(e,regHandler(i))):"function"==typeof e?e.bind(t):e}return Array.isArray(t)?"function"==typeof(r=t[n])?(...e)=>{e=Array.prototype[n].apply(t,e);return ARRAY_MUTATIONS.includes(n)&&touch(l),e}:"object"==typeof r?new Proxy(r,regHandler(extendPath(l,n))):r:t[n]},set(e,t,n){null!=n&&n[XIN_PATH]&&(n=n[XIN_VALUE]);t=extendPath(l,t);if(!isValidPath(t))throw new Error("setting invalid path "+t);let r=xin[t];return(r=null!=r&&null!=r[XIN_VALUE]?r[XIN_VALUE]:r)!==n&&setByPath(registry,t,n)&&touch(t),!0}}),observe=(e,t)=>{var n="function"==typeof t?t:xin[t];if("function"!=typeof n)throw new Error(`observe expects a function or path to a function, ${t} is neither`);return observe$1(e,n)},xin=new Proxy(registry,regHandler()),debounce=(t,n=250)=>{let r;return(...e)=>{void 0!==r&&clearTimeout(r),r=setTimeout(()=>{t(...e)},n)}},throttle=(t,n=250)=>{let r,i=Date.now()-n,o=!1;return(...e)=>{if(clearTimeout(r),r=setTimeout(async()=>{t(...e),i=Date.now()},n),!o&&Date.now()-i>=n){o=!0;try{t(...e),i=Date.now()}finally{o=!1}}}},hotReload=(r=()=>!0)=>{var e=localStorage.getItem("xin-state");if(null!=e){var t=JSON.parse(e);for(const n of Object.keys(t).filter(r))void 0!==xin[n]?Object.assign(xin[n],t[n]):xin[n]=t[n]}e=debounce(()=>{var e={},t=xin[XIN_VALUE];for(const n of Object.keys(t).filter(r))e[n]=t[n];localStorage.setItem("xin-state",JSON.stringify(e)),console.log("xin state saved to localStorage")},500);observe(r,e)},RADIANS_TO_DEGREES=180/Math.PI,DEGREES_TO_RADIANS=Math.PI/180;function clamp(e,t,n){return t<e?e:n<t?n:t}function lerp(e,t,n){return(n=clamp(0,n,1))*(t-e)+e}var moreMath=Object.freeze({__proto__:null,DEGREES_TO_RADIANS:DEGREES_TO_RADIANS,RADIANS_TO_DEGREES:RADIANS_TO_DEGREES,clamp:clamp,lerp:lerp});const hex2=e=>("00"+Math.round(Number(e)).toString(16)).slice(-2),span=null!=globalThis.document?globalThis.document.createElement("span"):{style:{color:""}};class HslColor{constructor(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=r-Math.min(e,t,n),n=0!=i?r===e?(t-n)/i:r===t?2+(n-e)/i:4+(e-t)/i:0;this.h=60*n<0?60*n+360:60*n,this.s=0!=i?r<=.5?i/(2*r-i):i/(2-(2*r-i)):0,this.l=(2*r-i)/2}}class Color{static fromCss(e){span.style.color=e;var[e,t,n,r]=span.style.color.match(/[\d.]+/g);return new Color(Number(e),Number(t),Number(n),null==r?1:Number(r))}static fromHsl(e,t,n,r=1){return Color.fromCss(`hsla(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*n).toFixed(0)}%, ${r.toFixed(2)})`)}constructor(e,t,n,r=1){this.r=clamp(0,e,255),this.g=clamp(0,t,255),this.b=clamp(0,n,255),this.a=void 0!==r?clamp(0,r,1):r=1}get inverse(){return new Color(255-this.r,255-this.g,255-this.b,this.a)}get inverseLuminance(){var{h:e,s:t,l:n}=this._hsl;return Color.fromHsl(e,t,1-n,this.a)}get rgb(){var{r:e,g:t,b:n}=this;return`rgb(${e.toFixed(0)},${t.toFixed(0)},${n.toFixed(0)})`}get rgba(){var{r:e,g:t,b:n,a:r}=this;return`rgba(${e.toFixed(0)},${t.toFixed(0)},${n.toFixed(0)},${r.toFixed(2)})`}get RGBA(){return[this.r/255,this.g/255,this.b/255,this.a]}get ARGB(){return[this.a,this.r/255,this.g/255,this.b/255]}get _hsl(){return null==this._hslCached&&(this._hslCached=new HslColor(this.r,this.g,this.b)),this._hslCached}get hsl(){var{h:e,s:t,l:n}=this._hsl;return`hsl(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*n).toFixed(0)}%)`}get hsla(){var{h:e,s:t,l:n}=this._hsl;return`hsla(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*n).toFixed(0)}%, ${this.a.toFixed(2)})`}get mono(){var e=255*this.brightness;return new Color(e,e,e)}get brightness(){return(.299*this.r+.587*this.g+.114*this.b)/255}get html(){return 1===this.a?"#"+hex2(this.r)+hex2(this.g)+hex2(this.b):"#"+hex2(this.r)+hex2(this.g)+hex2(this.b)+hex2(Math.floor(255*this.a))}brighten(e){var{h:t,s:n,l:r}=this._hsl,r=clamp(0,r+e*(1-r),1);return Color.fromHsl(t,n,r,this.a)}darken(e){var{h:t,s:n,l:r}=this._hsl,r=clamp(0,r*(1-e),1);return Color.fromHsl(t,n,r,this.a)}saturate(e){var{h:t,s:n,l:r}=this._hsl,n=clamp(0,n+e*(1-n),1);return Color.fromHsl(t,n,r,this.a)}desaturate(e){var{h:t,s:n,l:r}=this._hsl,n=clamp(0,n*(1-e),1);return Color.fromHsl(t,n,r,this.a)}rotate(e){var{h:t,s:n,l:r}=this._hsl,t=(t+360+e)%360;return Color.fromHsl(t,n,r,this.a)}opacity(e){var{h:t,s:n,l:r}=this._hsl;return Color.fromHsl(t,n,r,e)}swatch(){var{r:e,g:t,b:n,a:r}=this;console.log(`%c   %c ${this.html}, rgba(${e}, ${t}, ${n}, ${r}), `+this.hsla,`background-color: rgba(${e}, ${t}, ${n}, ${r})`,"background-color: #eee")}blend(e,t){return new Color(lerp(this.r,e.r,t),lerp(this.g,e.g,t),lerp(this.b,e.b,t),lerp(this.a,e.a,t))}}function deepClone(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(deepClone);var t={};for(const r in e){var n=e[r];t[r]=null!=e&&"object"==typeof e?deepClone(n):n}return t}const BOUND_CLASS="-xin-data",BOUND_SELECTOR="."+BOUND_CLASS,EVENT_CLASS="-xin-event",EVENT_SELECTOR="."+EVENT_CLASS,elementToHandlers=new WeakMap,elementToBindings=new WeakMap,cloneWithBindings=e=>{var t,n,r=e.cloneNode();r instanceof HTMLElement&&(t=elementToBindings.get(e),n=elementToHandlers.get(e),null!=t&&elementToBindings.set(r,deepClone(t)),null!=n)&&elementToHandlers.set(r,deepClone(n));for(const i of e.childNodes)i instanceof HTMLElement||i instanceof DocumentFragment?r.appendChild(cloneWithBindings(i)):r.appendChild(i.cloneNode());return r},elementToItem=new WeakMap,getListItem=e=>{for(var t=document.body.parentElement;null!=e.parentElement&&e.parentElement!==t;){var n=elementToItem.get(e);if(null!=n)return n;e=e.parentElement}return!1},document$1=globalThis["document"],handleChange=(observe(()=>!0,r=>{for(const s of document$1.querySelectorAll(BOUND_SELECTOR))for(const l of elementToBindings.get(s)){let{path:e,binding:t,options:n}=l;var i=t["toDOM"];if(null!=i){if(e.startsWith("^")){var o=getListItem(s);if(null==o||null==o[XIN_PATH])throw console.error("Cannot resolve relative binding "+e,s,"is not part of a list"),new Error("Cannot resolve relative binding "+e);e=l.path=""+o[XIN_PATH]+e.substring(1)}e.startsWith(r)&&i(s,xin[e],n)}}}),e=>{let t=e.target.closest(BOUND_SELECTOR);for(;null!=t;){for(const i of elementToBindings.get(t)){var{binding:n,path:r}=i,n=n["fromDOM"];if(null!=n){let e;try{e=n(t,i.options)}catch(e){throw console.error("Cannot get value from",t,"via",i),new Error("Cannot obtain value fromDOM")}null!=e&&(null==(n=xin[r])?xin[r]=e:(null!=n[XIN_PATH]?n[XIN_VALUE]:n)!==(n=null!=e[XIN_PATH]?e[XIN_VALUE]:e)&&(xin[r]=n))}}t=t.parentElement.closest(BOUND_SELECTOR)}}),bind=(null!=globalThis.document&&(document$1.body.addEventListener("change",handleChange,!0),document$1.body.addEventListener("input",handleChange,!0)),(e,t,n,r)=>{if(e instanceof DocumentFragment)throw new Error("bind cannot bind to a DocumentFragment");let i;if("object"==typeof t&&void 0===t[XIN_PATH]&&void 0===r?(o=t["value"],i="string"==typeof o?o:o[XIN_PATH],delete(r=t).value):i="string"==typeof t?t:t[XIN_PATH],null==i)throw new Error("bind requires a path or object with xin Proxy");var o=n["toDOM"];e.classList.add(BOUND_CLASS);let s=elementToBindings.get(e);return null==s&&(s=[],elementToBindings.set(e,s)),s.push({path:i,binding:n,options:r}),null==o||i.startsWith("^")||touch(i),e}),handledEventTypes=new Set,handleBoundEvent=n=>{let e=n?.target.closest(EVENT_SELECTOR),r=!1;for(var t=new Proxy(n,{get(e,t){return"stopPropagation"===t?()=>{n.stopPropagation(),r=!0}:"function"==typeof(t=e[t])?t.bind(e):t}});!r&&null!=e;){for(const o of elementToHandlers.get(e)[n.type]||[]){if("function"==typeof o)o(t);else{var i=xin[o];if("function"!=typeof i)throw new Error("no event handler found at path "+o);i(t)}r}e=e.parentElement.closest(EVENT_SELECTOR)}},on=(e,t,n)=>{let r=elementToHandlers.get(e);e.classList.add(EVENT_CLASS),null==r&&(r={},elementToHandlers.set(e,r)),r[t]||(r[t]=[]),r[t].includes(n)||r[t].push(n),handledEventTypes.has(t)||(handledEventTypes.add(t),document$1.body.addEventListener(t,handleBoundEvent,!0))},dispatch=(e,t)=>{t=new Event(t);e.dispatchEvent(t)},valueType=e=>e instanceof HTMLInputElement?e.type:e instanceof HTMLSelectElement&&e.hasAttribute("multiple")?"multi-select":"other",setValue=(e,t)=>{switch(valueType(e)){case"radio":e.checked=e.value===t;break;case"checkbox":e.checked=t;break;case"date":e.valueAsDate=new Date(t);break;case"multi-select":for(const n of[...e.querySelectorAll("option")])n.selected=t[n.value];break;default:e.value=t}},getValue=e=>{switch(valueType(e)){case"radio":var t=e.parentElement?.querySelector(`[name="${e.name}"]:checked`);return null!=t?t.value:null;case"checkbox":return e.checked;case"date":return e.valueAsDate.toISOString();case"multi-select":return[...e.querySelectorAll("option")].reduce((e,t)=>(e[t.value]=t.selected,e),{});default:return e.value}},ResizeObserver=globalThis["ResizeObserver"],resizeObserver=null!=ResizeObserver?new ResizeObserver(e=>{for(const n of e){var t=n.target;dispatch(t,"resize")}}):{observe(){},unobserve(){}},appendContentToElement=(t,e)=>{if(null!=t&&null!=e)if("string"==typeof e)t.textContent=e;else if(Array.isArray(e))e.forEach(e=>{t.append(e instanceof Node?cloneWithBindings(e):e)});else{if(!(e instanceof HTMLElement))throw new Error("expect text content or document node");t.append(cloneWithBindings(e))}},listBindingRef=Symbol("list-binding"),SLICE_INTERVAL_MS=16;function updateRelativeBindings(e,t){var n=[...e.querySelectorAll(BOUND_SELECTOR)];e.matches(BOUND_SELECTOR)&&n.unshift(e);for(const r of n)for(const i of elementToBindings.get(r))i.path.startsWith("^")&&(i.path=""+t+i.path.substring(1)),null!=i.binding.toDOM&&i.binding.toDOM(r,xin[i.path])}class ListBinding{constructor(e,t={}){if(this._array=[],this.boundElement=e,this.itemToElement=new WeakMap,1!==e.children.length)throw new Error("ListBinding expects an element with exactly one child element");if(e.children[0]instanceof HTMLTemplateElement){var n=e.children[0];if(1!==n.content.children.length)throw new Error("ListBinding expects a template with exactly one child element");this.template=cloneWithBindings(n.content.children[0])}else this.template=e.children[0],this.template.remove();this.listTop=document.createElement("div"),this.listBottom=document.createElement("div"),this.boundElement.append(this.listTop),this.boundElement.append(this.listBottom),null!=(this.options=t).virtual&&(resizeObserver.observe(this.boundElement),this._update=throttle(()=>{this.update(this._array,!0)},SLICE_INTERVAL_MS),this.boundElement.addEventListener("scroll",this._update),this.boundElement.addEventListener("resize",this._update))}visibleSlice(){var t=this.options["virtual"];let n=0,r=this._array.length-1,i=0,o=0;if(null!=t){var s=this.boundElement.offsetWidth,l=this.boundElement.offsetHeight,s=null!=t.width?Math.max(1,Math.floor(s/t.width)):1,a=Math.ceil(l/t.height)+1,h=Math.ceil(this._array.length/s),u=s*a;let e=Math.floor(this.boundElement.scrollTop/t.height);e>h-a+1&&(e=Math.max(0,h-a+1)),n=e*s,r=n+u-1,i=e*t.height,o=h*t.height-l-i}return{firstItem:n,lastItem:r,topBuffer:i,bottomBuffer:o}}update(i,e){this._array=i=null==i?[]:i;var o,s,{initInstance:l,updateInstance:a}=this.options,h=i[XIN_PATH],u=this.visibleSlice(),t=this._previousSlice,{firstItem:d,lastItem:c,topBuffer:f,bottomBuffer:p}=u;if(!0!==e||null==t||d!==t.firstItem||c!==t.lastItem){this._previousSlice=u;let e=0,t=0,n=0;for(const y of[...this.boundElement.children])y!==this.listTop&&y!==this.listBottom&&(null==(o=elementToItem.get(y))?y.remove():((s=i.indexOf(o))<d||c<s)&&(y.remove(),this.itemToElement.delete(o),elementToItem.delete(y),e++));this.listTop.style.height=String(f)+"px",this.listBottom.style.height=String(p)+"px";var m=[],g=this.options["idPath"];for(let e=d;e<=c;e++){var b,v=i[e];if(void 0!==v){let e=this.itemToElement.get(v[XIN_VALUE]);null==e&&(n++,e=cloneWithBindings(this.template),"object"==typeof v&&(this.itemToElement.set(v[XIN_VALUE],e),elementToItem.set(e,v[XIN_VALUE])),this.boundElement.insertBefore(e,this.listBottom),null!=g&&(b=v[g],updateRelativeBindings(e,h+`[${g}=${b}]`)),null!=l)&&l(e,v),null!=a&&a(e,v),m.push(e)}}let r=null;for(const E of m)E.previousElementSibling!==r&&(t++,null!=r?.nextElementSibling?this.boundElement.insertBefore(E,r.nextElementSibling):this.boundElement.insertBefore(E,this.listBottom)),r=E;settings.perf&&console.log(h,"updated",{removed:e,created:n,moved:t})}}}const getListBinding=(e,t)=>{let n=e[listBindingRef];return null==n&&(n=new ListBinding(e,t),e[listBindingRef]=n),n},bindings={value:{toDOM(e,t){setValue(e,t)},fromDOM(e){return getValue(e)}},text:{toDOM(e,t){e.textContent=t}},enabled:{toDOM(e,t){e.disabled=!t}},disabled:{toDOM(e,t){e.disabled=Boolean(t)}},style:{toDOM(e,t){if("object"==typeof t)for(const n of Object.keys(t))e.style[n]=t[n];else{if("string"!=typeof t)throw new Error("style binding expects either a string or object");e.setAttribute("style",t)}}},list:{toDOM(e,t,n){getListBinding(e,n).update(t)}}};function camelToKabob(e){return e.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())}function kabobToCamel(e){return e.replace(/-([a-z])/g,(e,t)=>t.toLocaleUpperCase())}const templates={},makeComponent=(...t)=>(...e)=>elements.div(...e,...t),create=(e,...t)=>{void 0===templates[e]&&(templates[e]=globalThis.document.createElement(e));const n=templates[e].cloneNode();var r={};for(const l of t)l instanceof Element||l instanceof DocumentFragment||"string"==typeof l||"number"==typeof l?(n instanceof HTMLTemplateElement?n.content:n).append(l):Object.assign(r,l);for(const a of Object.keys(r)){var i=r[a];if("apply"===a)i(n);else if("style"===a)if("object"==typeof i)for(const h of Object.keys(i))h.startsWith("--")?n.style.setProperty(h,i[h]):n.style[h]=i[h];else n.setAttribute("style",i);else if(null!=a.match(/^on[A-Z]/)){var o=a.substring(2).toLowerCase();on(n,o,i)}else if(null!=a.match(/^bind[A-Z]/)){var o=a.substring(4,5).toLowerCase()+a.substring(5),s=bindings[o];if(void 0===s)throw new Error(a+` is not allowed, bindings.${o} is not defined`);bind(n,i,s)}else{s=camelToKabob(a);"class"===s?i.split(" ").forEach(e=>{n.classList.add(e)}):void 0!==n[s]?n[s]=i:"boolean"==typeof i?i?n.setAttribute(s,""):n.removeAttribute(s):n.setAttribute(s,i)}}return n},fragment=(...e)=>{var t=globalThis.document.createDocumentFragment();for(const n of e)t.append(n);return t},_elements={fragment:fragment},elements=new Proxy(_elements,{get(e,t){if(null==(t=t.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())).match(/^\w+(-\w+)*$/))throw new Error(t+" does not appear to be a valid element tagName");return void 0===e[t]&&(e[t]=(...e)=>create(t,...e)),e[t]},set(){throw new Error("You may not add new properties to elements")}}),dimensionalProps=["left","right","top","bottom","gap"],isDimensional=e=>null!=e.match(/(width|height|size|margin|padding|radius)/)||dimensionalProps.includes(e),renderStatement=(e,t,n="")=>{var r,i=camelToKabob(e);return"object"==typeof t?(r=Object.keys(t).map(e=>renderStatement(e,t[e],n+"  ")).join("\n"),n+`  ${e} {
${r}
${n}  }`):"number"==typeof t&&isDimensional(i)?n+`  ${i}: ${t}px;`:n+`  ${i}: ${t};`},css=(r,i="")=>{return Object.keys(r).map(e=>{const t=r[e];var n=Object.keys(t).map(e=>renderStatement(e,t[e])).join("\n");return""+i+e+` {
${n}
}`}).join("\n\n")},initVars=e=>{var t={};for(const r of Object.keys(e)){var n=e[r];t["--"+camelToKabob(r)]="number"==typeof n?String(n)+"px":n}return t},darkMode=t=>{var n={};for(const r of Object.keys(t)){let e=t[r];"string"==typeof e&&null!=e.match(/^(#|rgb[a]?\(|hsl[a]?\()/)&&(e=Color.fromCss(e).inverseLuminance.html,n["--"+camelToKabob(r)]=e)}return n},vars=new Proxy({},{get(e,t){if(null==e[t]){var[,n,,r,i,o]=(t=t.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())).match(/^([^\d_]*)((_)?(\d+)(\w*))?$/),n="--"+n;if(null!=i){var s=null==r?Number(i)/100:-Number(i)/100;switch(o){case"b":var l=getComputedStyle(document.body).getPropertyValue(n);e[t]=(0<s?Color.fromCss(l).brighten(s):Color.fromCss(l).darken(-s)).rgba;break;case"s":l=getComputedStyle(document.body).getPropertyValue(n);e[t]=(0<s?Color.fromCss(l).saturate(s):Color.fromCss(l).desaturate(-s)).rgba;break;case"h":l=getComputedStyle(document.body).getPropertyValue(n);e[t]=Color.fromCss(l).rotate(100*s).rgba,console.log(Color.fromCss(l).hsla,Color.fromCss(l).rotate(s).hsla);break;case"o":l=getComputedStyle(document.body).getPropertyValue(n);e[t]=Color.fromCss(l).opacity(s).rgba;break;case"":e[t]=`calc(var(${n}) * ${s})`;break;default:throw console.error(o),new Error(`Unrecognized method ${o} for css variable `+n)}}else e[t]=`var(${n})`}return e[t]}});class Component extends HTMLElement{static StyleNode(e){return elements.style(css(e))}static elementCreator(n){if(null==this._elementCreator){let e=null!=n?n.tag:null,t=(null!=e||(e=(e=camelToKabob(this.name)).startsWith("-")?e.substring(1):e).includes("-")||(e+="-elt"),0);for(;null==this._elementCreator;){var r=1===(t+=1)?e:e+"-"+t;try{window.customElements.define(r,this,n),this._elementCreator=elements[r]}catch(e){throw new Error(`could not define ${this.name} as <${r}>: `+String(e))}}}return this._elementCreator}initAttributes(...n){const r={},i={};new MutationObserver(e=>{let t=!1;e.forEach(e=>{t=!(!e.attributeName||!n.includes(kabobToCamel(e.attributeName)))}),t&&void 0!==this.queueRender&&this.queueRender(!1)}).observe(this,{attributes:!0}),n.forEach(t=>{r[t]=deepClone(this[t]);const n=camelToKabob(t);Object.defineProperty(this,t,{enumerable:!1,get(){return"boolean"==typeof r[t]?this.hasAttribute(n):this.hasAttribute(n)?"number"==typeof r[t]?parseFloat(this.getAttribute(n)):this.getAttribute(n):(void 0!==i[t]?i:r)[t]},set(e){"boolean"==typeof r[t]?e!==this[t]&&(e?this.setAttribute(n,""):this.removeAttribute(n),this.queueRender()):"number"==typeof r[t]?e!==parseFloat(this[t])&&(this.setAttribute(n,e),this.queueRender()):"object"!=typeof e&&""+e==""+this[t]||(null==e||"object"==typeof e?this.removeAttribute(n):this.setAttribute(n,e),this.queueRender(),i[t]=e)}})})}initValue(){var e=Object.getOwnPropertyDescriptor(this,"value");if(void 0!==e&&void 0===e.get&&void 0===e.set){let t=this.hasAttribute("value")?this.getAttribute("value"):deepClone(this.value);delete this.value,Object.defineProperty(this,"value",{enumerable:!1,get(){return t},set(e){t!==e&&(t=e,this.queueRender(!0))}})}}get refs(){const r=null!=this.shadowRoot?this.shadowRoot:this;return null==this._refs&&(this._refs=new Proxy({},{get(t,n){if(void 0===t[n]){let e=r.querySelector(`[data-ref="${n}"]`);if(null==(e=null==e?r.querySelector(n):e))throw new Error(`elementRef "${n}" does not exist!`);e.removeAttribute("data-ref"),t[n]=e}return t[n]}})),this._refs}constructor(){super(),this.content=elements.slot(),this._changeQueued=!1,this._renderQueued=!1,this._hydrated=!1,this.initAttributes("hidden"),this._value=deepClone(this.defaultValue)}connectedCallback(){this.hydrate(),null!=this.role&&this.setAttribute("role",this.role),void 0!==this.onResize&&(resizeObserver.observe(this),null==this._onResize&&(this._onResize=this.onResize.bind(this)),this.addEventListener("resize",this._onResize)),null!=this.value&&null!=this.getAttribute("value")&&(this._value=this.getAttribute("value"))}disconnectedCallback(){resizeObserver.unobserve(this)}queueRender(e=!1){this._changeQueued||(this._changeQueued=e),this._renderQueued||(this._renderQueued=!0,requestAnimationFrame(()=>{this._changeQueued&&dispatch(this,"change"),this._changeQueued=!1,this._renderQueued=!1,this.render()}))}hydrate(){var e;this._hydrated||(this.initValue(),void 0!==this.styleNode?((e=this.attachShadow({mode:"open"})).appendChild(this.styleNode),appendContentToElement(e,this.content)):appendContentToElement(this,this.content),this._hydrated=!0)}render(){this.hydrate()}}Component.elements=elements;export{Color,Component,moreMath as MoreMath,bind,bindings,css,darkMode,elements,getListItem,hotReload,initVars,makeComponent,observe,observerShouldBeRemoved,on,settings,touch,unobserve,vars,xin,XIN_PATH,XIN_VALUE};
//# sourceMappingURL=cdn/index.min.mjs.map