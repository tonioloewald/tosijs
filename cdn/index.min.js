"use strict";var react=require("react");const xinPath=Symbol("xin-path"),xinValue=Symbol("xin-value"),settings={debug:!1,perf:!1},observerShouldBeRemoved=Symbol("observer should be removed"),listeners=[],touchedPaths=[];let updateTriggered=!1,resolveUpdate;const getPath=e=>"object"==typeof e?e[xinPath]:e;class Listener{constructor(t,e){var r="string"==typeof e?`"${e}"`:"function "+e.name;let n;if("string"==typeof t)this.test=e=>"string"==typeof e&&""!==e&&(t.startsWith(e)||e.startsWith(t)),n=`test = "${t}"`;else if(t instanceof RegExp)this.test=t.test.bind(t),n=`test = "${t.toString()}"`;else{if(!(t instanceof Function))throw new Error("expect listener test to be a string, RegExp, or test function");this.test=t,n="test = function "+t.name}if(this.description=n+", "+r,"function"!=typeof e)throw new Error("expect callback to be a path or function");this.callback=e,listeners.push(this)}}const update=()=>{settings.perf&&console.time("xin async update");for(const r of[...touchedPaths])listeners.filter(t=>{let e;try{e=t.test(r)}catch(e){throw new Error(`Listener ${t.description} threw "${e}" at "${r}"`)}return e===observerShouldBeRemoved?(unobserve(t),!1):e}).forEach(t=>{let e;try{e=t.callback(r)}catch(e){console.error(`Listener ${t.description} threw "${e}" handling "${r}"`)}e===observerShouldBeRemoved&&unobserve(t)});touchedPaths.splice(0),updateTriggered=!1,"function"==typeof resolveUpdate&&resolveUpdate(),settings.perf&&console.timeEnd("xin async update")},touch=e=>{const t=getPath(e);!1===updateTriggered&&(new Promise(e=>{resolveUpdate=e}),updateTriggered=setTimeout(update)),null==touchedPaths.find(e=>t.startsWith(e))&&touchedPaths.push(t)},observe$1=(e,t)=>new Listener(e,t),unobserve=e=>{e=listeners.indexOf(e);if(!(-1<e))throw new Error("unobserve failed, listener not found");listeners.splice(e,1)},stringify=e=>{try{return JSON.stringify(e)}catch(e){return"{has circular references}"}},makeError=(...e)=>new Error(e.map(stringify).join(" ")),now36=()=>new Date(parseInt("1000000000",36)+Date.now()).valueOf().toString(36).slice(1);let _seq=0;const seq=()=>(parseInt("10000",36)+ ++_seq).toString(36).slice(-5),id=()=>now36()+seq(),_delete_={},_newObject_={};function pathParts(t){if(""===t)return[];if(Array.isArray(t))return t;for(var r=[];0<t.length;){let e=t.search(/\[[^\]]+\]/);if(-1===e){r.push(t.split("."));break}var n=t.slice(0,e);t=t.slice(e),""!==n&&r.push(n.split(".")),e=t.indexOf("]")+1,r.push(t.slice(1,e-1)),"."===t.slice(e,e+1)&&(e+=1),t=t.slice(e)}return r}const idPathMaps=new WeakMap;function buildIdPathValueMap(e,r){void 0===idPathMaps.get(e)&&idPathMaps.set(e,{}),void 0===idPathMaps.get(e)[r]&&(idPathMaps.get(e)[r]={});const n=idPathMaps.get(e)[r];return"_auto_"===r?e.forEach((e,t)=>{void 0===e._auto_&&(e._auto_=id()),n[e._auto_+""]=t}):e.forEach((e,t)=>{n[getByPath(e,r)+""]=t}),n}function getIdPathMap(e,t){return void 0===idPathMaps.get(e)||void 0===idPathMaps.get(e)[t]?buildIdPathValueMap(e,t):idPathMaps.get(e)[t]}function keyToIndex(e,t,r){r+="";let n=getIdPathMap(e,t)[r];return n=void 0!==n&&getByPath(e[n],t)+""===r?n:buildIdPathValueMap(e,t)[r]}function byKey(e,t,r){return void 0===e[t]&&void 0!==r&&(e[t]=r),e[t]}function byIdPath(e,t,r,n){let i=""!==t?keyToIndex(e,t,r):r;if(n===_delete_)return e.splice(i,1),idPathMaps.delete(e),Symbol("deleted");if(n===_newObject_)""===t&&void 0===e[i]&&(e[i]={});else if(void 0!==n)if(void 0!==i)e[i]=n;else{if(""===t||getByPath(n,t)+""!=r+"")throw new Error(`byIdPath insert failed at [${t}=${r}]`);e.push(n),i=e.length-1}return e[i]}function expectArray(e){if(!Array.isArray(e))throw makeError("setByPath failed: expected array, found",e)}function expectObject(e){if(null==e||e.constructor!==Object)throw makeError("setByPath failed: expected Object, found",e)}function getByPath(e,t){var r=pathParts(t);let n=e,i,s,o,a;for(i=0,s=r.length;void 0!==n&&i<s;i++){var l,h,c=r[i];if(Array.isArray(c))for(o=0,a=c.length;void 0!==n&&o<a;o++){var u=c[o];n=n[u]}else if(0===n.length){if(n=n[c.slice(1)],"="!==c[0])return}else n=c.includes("=")?([l,...h]=c.split("="),byIdPath(n,l,h.join("="))):(o=parseInt(c,10),n[o])}return n}function setByPath(e,t,r){let n=e;for(var i=pathParts(t);null!=n&&0<i.length;){var s=i.shift();if("string"==typeof s){var o=s.indexOf("=");if(-1<o){(0===o?expectObject:expectArray)(n);var a=s.slice(0,o),o=s.slice(o+1);if(n=byIdPath(n,a,o,0<i.length?_newObject_:r),0===i.length)return!0}else{expectArray(n);a=parseInt(s,10);if(!(0<i.length)){if(r!==_delete_){if(n[a]===r)return!1;n[a]=r}else n.splice(a,1);return!0}n=n[a]}}else{if(!(Array.isArray(s)&&0<s.length))throw new Error("setByPath failed, bad path "+t);for(expectObject(n);0<s.length;){var l=s.shift();if(!(0<s.length||0<i.length)){if(r!==_delete_){if(n[l]===r)return!1;n[l]=r}else{if(!Object.prototype.hasOwnProperty.call(n,l))return!1;delete n[l]}return!0}n=byKey(n,l,0<s.length?{}:[])}}}throw new Error(`setByPath(${e}, ${t}, ${r}) failed`)}const ARRAY_MUTATIONS=["sort","splice","copyWithin","fill","pop","push","reverse","shift","unshift"],registry={},validPath=/^\.?([^.[\](),])+(\.[^.[\](),]+|\[\d+\]|\[[^=[\](),]*=[^[\]()]+\])*$/,isValidPath=e=>validPath.test(e),extendPath=(e="",t="")=>""===e?t:null!==t.match(/^\d+$/)||t.includes("=")?e+`[${t}]`:e+"."+t,regHandler=(a="")=>({get(t,e){if(e===xinPath)return a;if(e===xinValue)return t;if("symbol"==typeof e)return t[e];let r=e;var n,i,e=r.match(/^([^.[]+)\.(.+)$/)??r.match(/^([^\]]+)(\[.+)/)??r.match(/^(\[[^\]]+\])\.(.+)$/)??r.match(/^(\[[^\]]+\])\[(.+)$/);if(null!==e)return[,e,n]=e,i=extendPath(a,e),null!==(e=getByPath(t,e))&&"object"==typeof e?new Proxy(e,regHandler(i))[n]:e;if(r.startsWith("[")&&r.endsWith("]")&&(r=r.substring(1,r.length-1)),!Array.isArray(t)&&void 0!==t[r]||Array.isArray(t)&&r.includes("=")){let e;if(r.includes("=")){const[s,o]=r.split("=");e=t.find(e=>""+getByPath(e,s)===o)}else e=t[r];return null!==e&&"object"==typeof e?(i=extendPath(a,r),new Proxy(e,regHandler(i))):"function"==typeof e?e.bind(t):e}return Array.isArray(t)?"function"==typeof(n=t[r])?(...e)=>{e=Array.prototype[r].apply(t,e);return ARRAY_MUTATIONS.includes(r)&&touch(a),e}:"object"==typeof n?new Proxy(n,regHandler(extendPath(a,r))):n:t[r]},set(e,t,r){null!=r&&r[xinPath]&&(r=r[xinValue]);t=extendPath(a,t);if(!isValidPath(t))throw new Error("setting invalid path "+t);let n=xin[t];return(n=null!=n&&null!=n[xinValue]?n[xinValue]:n)!==r&&setByPath(registry,t,r)&&touch(t),!0}}),observe=(e,t)=>{var r="function"==typeof t?t:xin[t];if("function"!=typeof r)throw new Error(`observe expects a function or path to a function, ${t} is neither`);return observe$1(e,r)},xin=new Proxy(registry,regHandler()),useXin=(t,e="")=>{const[r,n]=react.useState(void 0!==xin[t]?xin[t]:e);react.useEffect(()=>{const e=observe(t,()=>{n(xin[t])});return()=>{unobserve(e)}});return[r,e=>{xin[t]=e}]},asyncFunc=async()=>{},isAsync=e=>e.constructor===asyncFunc.constructor,describe=e=>null===e?"null":Array.isArray(e)?"array":"number"==typeof e&&isNaN(e)?"NaN":"string"==typeof e&&e.startsWith("#")?e:e instanceof Promise?"promise":"function"==typeof e?e.constructor===(async()=>{}).constructor?"async":"function":"object"==typeof e&&"Object"!==e.constructor.name?e.constructor.name:typeof e,parseFloatOrInfinity=e=>"-∞"===e?-1/0:"∞"===e[0]?1/0:parseFloat(e),inRange=(t,e)=>{let r,n;if(void 0!==t){try{[,r,n]=t.match(/^([[(]-?[\d.\u221E]+)?,?(-?[\d.\u221E]+[\])])?$/)}catch(e){throw new Error("bad range "+t)}if(void 0!==r&&""!==r){t=parseFloatOrInfinity(r.substring(1));if("("===r[0]){if(e<=t)return!1}else if(e<t)return!1}if(void 0!==n&&""!==n){t=parseFloatOrInfinity(n);if(n.endsWith(")")){if(t<=e)return!1}else if(t<e)return!1}}return!0},regExps={},regexpTest=(e,t)=>{return(void 0!==regExps[e]?regExps[e]:regExps[e]=new RegExp(e)).test(t)},isInstanceOf=(t,r)=>{if("function"==typeof r)return t instanceof Function;{let e=Object.getPrototypeOf(t);for(;void 0!==e.constructor&&e.constructor!==Object;){if(e.constructor.name===r)return!0;e=Object.getPrototypeOf(e)}return!1}},specificTypeMatch=(e,t)=>{var[,r,n,,i]=e.match(/^#([?]?)([^\s]+)(\s(.*))?$/)||[];if(""!==r&&null==t)return!0;var s=describe(t);switch(n){case"forbidden":return!1;case"any":return null!=t;case"native":return"function"!=typeof t||"function () { [native code] }"!==t.toString()?!1:null==e||(isAsync(t)?e.match(/^async\b/):e.match(/^function\b/));case"function":return"function"!==s?!1:!0;case"number":return"number"!==s?!1:inRange(i,t);case"int":return"number"!==s||t!==Math.floor(t)?!1:inRange(i,t);case"union":return void 0!==i.split("||").find(e=>specificTypeMatch("#"+e,t));case"enum":try{return i.split("|").map(JSON.parse).includes(t)}catch(e){throw new Error(`bad enum specification (${i}), expect JSON strings`)}case"void":return"undefined"===s||"null"===s;case"nothing":return"undefined"===s;case"string":return"string"===s;case"regexp":return"string"===s&&regexpTest(i,t);case"array":return Array.isArray(t);case"instance":return isInstanceOf(t,i);case"promise":return t instanceof Promise;case"object":return null!==t&&"object"==typeof t&&!Array.isArray(t);default:if(s!==n)throw makeError("got",t,`expected "${e}", "${s}" does not match "${n}"`);return!0}},quoteIfString=e=>"string"==typeof e?`"${e}"`:"object"==typeof e?describe(e):e;function*arraySampler(e){let t=0;for(var r=Math.ceil(e.length/101);t<e.length;)t<5||t>e.length-5?(yield{sample:e[t],i:t},t++):(yield{sample:e[t],i:t},t=Math.min(t+r,e.length-4))}const matchType=(t,e,r=[],n="")=>{var i=describe(t),s=describe(e);if(i.startsWith("#")?specificTypeMatch(i,e):i===s)if("array"===i){s=0<e.length&&arraySampler(e);if(1===t.length&&!1!==s)for(var{sample:o,i:a}of s)matchType(t[0],o,r,`${n}[${a}]`);else if(1<t.length&&!1!==s)for(var{sample:l,i:h}of s){let e=!1;for(const c of t)if(0===matchType(c,l,[],"").length){e=!0;break}e||r.push(`${n}[${h}] had no matching type`)}}else"object"===i&&matchKeys(t,e,r,n);else r.push(`${""!==n?n+" ":""}was ${quoteIfString(e)}, expected `+i);return r},legalVarName=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/,matchKeys=(e,r,n=[],i="")=>{var s=new Set;for(const a of Object.keys(e))if(a.startsWith("#")){let t=legalVarName;try{"#"!==a&&(t=new RegExp(`^${a.substring(1)}$`))}catch(e){var o=`illegal regular expression in example key '${a}'`;throw n.push(o),makeError(o)}for(const l of Object.keys(r).filter(e=>t.test(e)))s.has(l)||(matchType(e[a],r[l],n,`${i}./^${a.substring(1)}$/:`+l),s.add(l))}else a.endsWith("?")?(o=a.slice(0,a.length-1),Object.hasOwnProperty.call(r,o)&&!s.has(o)&&(matchType(e[a],r[o],n,i+"."+o),s.add(o))):s.has(a)||(matchType(e[a],r[a],n,i+"."+a),s.add(a));return n};let TypeError$1=class{constructor(e){this.functionName="anonymous",this.isParamFailure=!1,this.errors=[],Object.assign(this,e)}toString(){var{functionName:e,isParamFailure:t,errors:r}=this;return e+`() failed, bad ${t?"parameter":"return"}: `+JSON.stringify(r)}};const assignReadOnly=(e,t)=>{t={...t};for(const r of Object.keys(t)){const n=t[r];Object.defineProperty(e,r,{enumerable:!0,get(){return n},set(e){throw new Error(r+" is read-only")}})}return e},matchParamTypes=(e,r)=>{for(let e=0;e<r.length;e++)if(r[e]instanceof TypeError$1)return r[e];var[e,t]=e.map((e,t)=>matchType(e,r[t]));return[...e,...t]},typeSafe=(i,s=[],o=void 0,a="anonymous")=>{if(matchParamTypes(["#function","#?array","#?any","#?string"],[i,s,o,a])instanceof TypeError$1)throw new Error("typeSafe was passed bad parameters");""!==i.name&&(a=i.name);let l=0;return assignReadOnly(function(...e){l+=1;var t,r,n=matchParamTypes(s,e);return n instanceof TypeError$1?n:0===n.length?(t=i(...e),0===(r=matchType(o,t)).length?t:new TypeError$1({functionName:a,isParamFailure:!1,expected:o,found:t,errors:r})):new TypeError$1({functionName:a,isParamFailure:!0,expected:s,found:e,errors:n})},{paramTypes:s,resultType:o,getCallCount:()=>l})},filterArray=(e,t)=>{if(Array.isArray(t)){if(0===e.length)return[...t];var r=[];for(const i of t){var n=e.find(e=>0===matchType(e,i).length);void 0!==n&&r.push(filter(n,i))}return r}},filterObject=(e,t)=>{if(!(0<matchType(e,t).length)){var r={};for(const i of Object.keys(e)){var n=filter(e[i],t[i]);void 0!==n&&(r[i]=n)}return r}},filter=(e,t)=>{if(null!=t&&!("object"!=typeof t&&0<matchType(e,t).length))return Array.isArray(e)?filterArray(e,t):"object"==typeof t?filterObject(e,t):0<matchType(e,t).length?void 0:t},debounce=(t,r=250)=>{let n;return(...e)=>{void 0!==n&&clearTimeout(n),n=setTimeout(()=>{t(...e)},r)}},throttle=(t,r=250)=>{let n,i=Date.now()-r,s=!1;return(...e)=>{if(clearTimeout(n),n=setTimeout(async()=>{t(...e),i=Date.now()},r),!s&&Date.now()-i>=r){s=!0;try{t(...e),i=Date.now()}finally{s=!1}}}},hotReload=(n=()=>!0)=>{var e=localStorage.getItem("xin-state");if(null!=e){var t=JSON.parse(e);for(const r of Object.keys(t).filter(n))void 0!==xin[r]?Object.assign(xin[r],t[r]):xin[r]=t[r]}e=debounce(()=>{var e={},t=xin[xinValue];for(const r of Object.keys(t).filter(n))e[r]=t[r];localStorage.setItem("xin-state",JSON.stringify(e)),console.log("xin state saved to localStorage")},500);observe(n,e)},RADIANS_TO_DEGREES=180/Math.PI,DEGREES_TO_RADIANS=Math.PI/180;function clamp(e,t,r){return t<e?e:r<t?r:t}function lerp(e,t,r){return(r=clamp(0,r,1))*(t-e)+e}var moreMath=Object.freeze({__proto__:null,RADIANS_TO_DEGREES:RADIANS_TO_DEGREES,DEGREES_TO_RADIANS:DEGREES_TO_RADIANS,clamp:clamp,lerp:lerp});const hex2=e=>("00"+Math.round(Number(e)).toString(16)).slice(-2),span=null!=globalThis.document?globalThis.document.createElement("span"):{style:{color:""}};class HslColor{constructor(e,t,r){e/=255,t/=255,r/=255;var n=Math.max(e,t,r),i=n-Math.min(e,t,r),r=0!=i?n===e?(t-r)/i:n===t?2+(r-e)/i:4+(e-t)/i:0;this.h=60*r<0?60*r+360:60*r,this.s=0!=i?n<=.5?i/(2*n-i):i/(2-(2*n-i)):0,this.l=(2*n-i)/2}}class Color{constructor(e,t,r,n=1){this.r=clamp(0,e,255),this.g=clamp(0,t,255),this.b=clamp(0,r,255),this.a=void 0!==n?clamp(0,n,1):n=1}static fromCss(e){span.style.color=e;var[e,t,r,n]=span.style.color.match(/[\d.]+/g);return new Color(Number(e),Number(t),Number(r),null==n?1:Number(n))}static fromHsl(e,t,r,n=1){return Color.fromCss(`hsla(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*r).toFixed(0)}%, ${n.toFixed(2)})`)}get inverse(){return new Color(255-this.r,255-this.g,255-this.b,this.a)}get inverseLuminance(){var{h:e,s:t,l:r}=this._hsl;return Color.fromHsl(e,t,1-r,this.a)}get rgb(){var{r:e,g:t,b:r}=this;return`rgb(${e.toFixed(0)},${t.toFixed(0)},${r.toFixed(0)})`}get rgba(){var{r:e,g:t,b:r,a:n}=this;return`rgba(${e.toFixed(0)},${t.toFixed(0)},${r.toFixed(0)},${n.toFixed(2)})`}get RGBA(){return[this.r/255,this.g/255,this.b/255,this.a]}get ARGB(){return[this.a,this.r/255,this.g/255,this.b/255]}get _hsl(){return null==this._hslCached&&(this._hslCached=new HslColor(this.r,this.g,this.b)),this._hslCached}get hsl(){var{h:e,s:t,l:r}=this._hsl;return`hsl(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*r).toFixed(0)}%)`}get hsla(){var{h:e,s:t,l:r}=this._hsl;return`hsla(${e.toFixed(0)}, ${(100*t).toFixed(0)}%, ${(100*r).toFixed(0)}%, ${this.a.toFixed(2)})`}get mono(){var e=255*this.brightness;return new Color(e,e,e)}get brightness(){return(.299*this.r+.587*this.g+.114*this.b)/255}get html(){return 1===this.a?"#"+hex2(this.r)+hex2(this.g)+hex2(this.b):"#"+hex2(this.r)+hex2(this.g)+hex2(this.b)+hex2(Math.floor(255*this.a))}brighten(e){var{h:t,s:r,l:n}=this._hsl,n=clamp(0,n+e*(1-n),1);return Color.fromHsl(t,r,n,this.a)}darken(e){var{h:t,s:r,l:n}=this._hsl,n=clamp(0,n*(1-e),1);return Color.fromHsl(t,r,n,this.a)}saturate(e){var{h:t,s:r,l:n}=this._hsl,r=clamp(0,r+e*(1-r),1);return Color.fromHsl(t,r,n,this.a)}desaturate(e){var{h:t,s:r,l:n}=this._hsl,r=clamp(0,r*(1-e),1);return Color.fromHsl(t,r,n,this.a)}rotate(e){var{h:t,s:r,l:n}=this._hsl,t=(t+360+e)%360;return Color.fromHsl(t,r,n,this.a)}opacity(e){var{h:t,s:r,l:n}=this._hsl;return Color.fromHsl(t,r,n,e)}swatch(){var{r:e,g:t,b:r,a:n}=this;console.log(`%c   %c ${this.html}, rgba(${e}, ${t}, ${r}, ${n}), `+this.hsla,`background-color: rgba(${e}, ${t}, ${r}, ${n})`,"background-color: #eee")}blend(e,t){return new Color(lerp(this.r,e.r,t),lerp(this.g,e.g,t),lerp(this.b,e.b,t),lerp(this.a,e.a,t))}}function deepClone(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(deepClone);var t={};for(const n in e){var r=e[n];t[n]=null!=e&&"object"==typeof e?deepClone(r):r}return t}const BOUND_CLASS="-xin-data",BOUND_SELECTOR="."+BOUND_CLASS,EVENT_CLASS="-xin-event",EVENT_SELECTOR="."+EVENT_CLASS,elementToHandlers=new WeakMap,elementToBindings=new WeakMap,cloneWithBindings=e=>{var t,r,n=e.cloneNode();n instanceof HTMLElement&&(t=elementToBindings.get(e),r=elementToHandlers.get(e),null!=t&&elementToBindings.set(n,deepClone(t)),null!=r&&elementToHandlers.set(n,deepClone(r)));for(const i of e.childNodes)i instanceof HTMLElement||i instanceof DocumentFragment?n.appendChild(cloneWithBindings(i)):n.appendChild(i.cloneNode());return n},elementToItem=new WeakMap,getListItem=e=>{for(var t=document.body.parentElement;null!=e.parentElement&&e.parentElement!==t;){var r=elementToItem.get(e);if(null!=r)return r;e=e.parentElement}return!1},handleChange=(observe(()=>!0,n=>{for(const o of globalThis.document.body.querySelectorAll(BOUND_SELECTOR))for(const a of elementToBindings.get(o)){let{path:e,binding:t,options:r}=a;var i=t["toDOM"];if(null!=i){if(e.startsWith("^")){var s=getListItem(o);if(null==s||null==s[xinPath])throw console.error("Cannot resolve relative binding "+e,o,"is not part of a list"),new Error("Cannot resolve relative binding "+e);e=a.path=""+s[xinPath]+e.substring(1)}e.startsWith(n)&&i(o,xin[e],r)}}}),e=>{let t=e.target.closest(BOUND_SELECTOR);for(;null!=t;){for(const i of elementToBindings.get(t)){var{binding:r,path:n}=i,r=r["fromDOM"];if(null!=r){let e;try{e=r(t,i.options)}catch(e){throw console.error("Cannot get value from",t,"via",i),new Error("Cannot obtain value fromDOM")}null!=e&&(null==(r=xin[n])?xin[n]=e:(null!=r[xinPath]?r[xinValue]:r)!==(r=null!=e[xinPath]?e[xinValue]:e)&&(xin[n]=r))}}t=t.parentElement.closest(BOUND_SELECTOR)}}),bind=(null!=globalThis.document&&(globalThis.document.body.addEventListener("change",handleChange,!0),globalThis.document.body.addEventListener("input",handleChange,!0)),(e,t,r,n)=>{if(e instanceof DocumentFragment)throw new Error("bind cannot bind to a DocumentFragment");let i;if("object"==typeof t&&void 0===t[xinPath]&&void 0===n?(s=t["value"],i="string"==typeof s?s:s[xinPath],delete(n=t).value):i="string"==typeof t?t:t[xinPath],null==i)throw new Error("bind requires a path or object with xin Proxy");var s=r["toDOM"];e.classList.add(BOUND_CLASS);let o=elementToBindings.get(e);return null==o&&(o=[],elementToBindings.set(e,o)),o.push({path:i,binding:r,options:n}),null==s||i.startsWith("^")||touch(i),e}),handledEventTypes=new Set,handleBoundEvent=r=>{let e=r?.target.closest(EVENT_SELECTOR),n=!1;for(var t=new Proxy(r,{get(e,t){return"stopPropagation"===t?()=>{r.stopPropagation(),n=!0}:"function"==typeof(t=e[t])?t.bind(e):t}});!n&&null!=e;){for(const s of elementToHandlers.get(e)[r.type]||[]){if("function"==typeof s)s(t);else{var i=xin[s];if("function"!=typeof i)throw new Error("no event handler found at path "+s);i(t)}n}e=e.parentElement.closest(EVENT_SELECTOR)}},on=(e,t,r)=>{let n=elementToHandlers.get(e);e.classList.add(EVENT_CLASS),null==n&&(n={},elementToHandlers.set(e,n)),n[t]||(n[t]=[]),n[t].includes(r)||n[t].push(r),handledEventTypes.has(t)||(handledEventTypes.add(t),document.body.addEventListener(t,handleBoundEvent,!0))},dispatch=(e,t)=>{t=new Event(t);e.dispatchEvent(t)},ResizeObserver=globalThis["ResizeObserver"],resizeObserver=null!=ResizeObserver?new ResizeObserver(e=>{for(const r of e){var t=r.target;dispatch(t,"resize")}}):{observe(){},unobserve(){}},appendContentToElement=(t,e)=>{if(null!=t&&null!=e)if("string"==typeof e)t.textContent=e;else if(Array.isArray(e))e.forEach(e=>{t.append(e instanceof Node?cloneWithBindings(e):e)});else{if(!(e instanceof HTMLElement))throw new Error("expect text content or document node");t.append(cloneWithBindings(e))}};var _ListBinding_instances,_ListBinding_array,_ListBinding_update,_ListBinding_previouseSlice,_ListBinding_visibleSlice,__classPrivateFieldGet=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e===t&&n:t.has(e))return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e);throw new TypeError("Cannot read private member from an object whose class did not declare it")},__classPrivateFieldSet=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e===t&&i:t.has(e))return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r;throw new TypeError("Cannot write private member to an object whose class did not declare it")};const listBindingRef=Symbol("list-binding"),SLICE_INTERVAL_MS=16;function updateRelativeBindings(e,t){var r=[...e.querySelectorAll(BOUND_SELECTOR)];e.matches(BOUND_SELECTOR)&&r.unshift(e);for(const n of r)for(const i of elementToBindings.get(n))i.path.startsWith("^")&&(i.path=""+t+i.path.substring(1)),null!=i.binding.toDOM&&i.binding.toDOM(n,xin[i.path])}class ListBinding{constructor(e,t={}){if(_ListBinding_instances.add(this),_ListBinding_array.set(this,[]),_ListBinding_update.set(this,void 0),_ListBinding_previouseSlice.set(this,void 0),this.boundElement=e,this.itemToElement=new WeakMap,1!==e.children.length)throw new Error("ListBinding expects an element with exactly one child element");if(e.children[0]instanceof HTMLTemplateElement){var r=e.children[0];if(1!==r.content.children.length)throw new Error("ListBinding expects a template with exactly one child element");this.template=cloneWithBindings(r.content.children[0])}else this.template=e.children[0],this.template.remove();this.listContainer=document.createElement("div"),this.boundElement.append(this.listContainer),null!=(this.options=t).virtual&&(resizeObserver.observe(this.boundElement),__classPrivateFieldSet(this,_ListBinding_update,throttle(()=>{this.update(__classPrivateFieldGet(this,_ListBinding_array,"f"),!0)},SLICE_INTERVAL_MS),"f"),this.boundElement.addEventListener("scroll",__classPrivateFieldGet(this,_ListBinding_update,"f")),this.boundElement.addEventListener("resize",__classPrivateFieldGet(this,_ListBinding_update,"f")))}update(i,e){__classPrivateFieldSet(this,_ListBinding_array,i=null==i?[]:i,"f");var{initInstance:s,updateInstance:o}=this.options,a=i[xinPath],l=__classPrivateFieldGet(this,_ListBinding_instances,"m",_ListBinding_visibleSlice).call(this),t=__classPrivateFieldGet(this,_ListBinding_previouseSlice,"f"),{firstItem:h,lastItem:c,topBuffer:u,bottomBuffer:d}=l;if(!0!==e||null==t||h!==t.firstItem||c!==t.lastItem){__classPrivateFieldSet(this,_ListBinding_previouseSlice,l,"f");let e=0,t=0,r=0;for(const v of[...this.listContainer.children]){var f,p=elementToItem.get(v);null==p?v.remove():((f=i.indexOf(p))<h||c<f)&&(v.remove(),this.itemToElement.delete(p),elementToItem.delete(v),e++)}this.listContainer.style.marginTop=String(u)+"px",this.listContainer.style.marginBottom=String(d)+"px";var m=[],g=this.options["idPath"];for(let e=h;e<=c;e++){var b,y=i[e];if(void 0!==y){let e=this.itemToElement.get(y[xinValue]);null==e&&(r++,e=cloneWithBindings(this.template),"object"==typeof y&&(this.itemToElement.set(y[xinValue],e),elementToItem.set(e,y[xinValue])),this.listContainer.append(e),null!=g&&(b=y[g],updateRelativeBindings(e,a+`[${g}=${b}]`)),null!=s&&s(e,y)),null!=o&&o(e,y),m.push(e)}}let n=null;for(const _ of m)_.previousElementSibling!==n&&(t++,null!=n?.nextElementSibling?this.listContainer.insertBefore(_,n.nextElementSibling):this.listContainer.append(_)),n=_;settings.perf&&console.log(a,"updated",{removed:e,created:r,moved:t})}}}_ListBinding_array=new WeakMap,_ListBinding_update=new WeakMap,_ListBinding_previouseSlice=new WeakMap,_ListBinding_instances=new WeakSet,_ListBinding_visibleSlice=function(){var t=this.options["virtual"];let r=0,n=__classPrivateFieldGet(this,_ListBinding_array,"f").length-1,i=0,s=0;if(null!=t){var o=this.boundElement.offsetWidth,a=this.boundElement.offsetHeight,o=null!=t.width?Math.max(1,Math.floor(o/t.width)):1,l=Math.ceil(a/t.height)+1,h=Math.ceil(__classPrivateFieldGet(this,_ListBinding_array,"f").length/o),c=o*l;let e=Math.floor(this.boundElement.scrollTop/t.height);e>h-l+1&&(e=Math.max(0,h-l+1),this.boundElement.scrollTop=e*t.height),r=e*o,n=r+c-1,i=e*t.height,s=h*t.height-a-i}return{firstItem:r,lastItem:n,topBuffer:i,bottomBuffer:s}};const getListBinding=(e,t)=>{let r=e[listBindingRef];return null==r&&(r=new ListBinding(e,t),e[listBindingRef]=r),r},bindings={value:{toDOM(e,t){if(void 0===e.value)throw new Error(`cannot set value of <${e.tagName}>`);e.value=t},fromDOM(e){return e.value}},text:{toDOM(e,t){e.textContent=t}},enabled:{toDOM(e,t){e.disabled=!t}},disabled:{toDOM(e,t){e.disabled=Boolean(t)}},style:{toDOM(e,t){if("object"==typeof t)for(const r of Object.keys(t))e.style[r]=t[r];else{if("string"!=typeof t)throw new Error("style binding expects either a string or object");e.setAttribute("style",t)}}},list:{toDOM(e,t,r){getListBinding(e,r).update(t)}}};function camelToKabob(e){return e.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())}function kabobToCamel(e){return e.replace(/-([a-z])/g,(e,t)=>t.toLocaleUpperCase())}const templates={},makeComponent=(...t)=>(...e)=>elements.div(...e,...t),create=(e,...t)=>{void 0===templates[e]&&(templates[e]=globalThis.document.createElement(e));var r=templates[e].cloneNode();for(const o of t)if(o instanceof Element||o instanceof DocumentFragment||"string"==typeof o||"number"==typeof o)(r instanceof HTMLTemplateElement?r.content:r).append(o);else for(const a of Object.keys(o)){var n=o[a];if("apply"===a)n(r);else if("style"===a)if("object"==typeof n)for(const l of Object.keys(n))l.startsWith("--")?r.style.setProperty(l,n[l]):r.style[l]=n[l];else r.setAttribute("style",n);else if(null!=a.match(/^on[A-Z]/)){var i=a.substring(2).toLowerCase();on(r,i,n)}else if(null!=a.match(/^bind[A-Z]/)){var i=a.substring(4).toLowerCase(),s=bindings[i];if(void 0===s)throw new Error(a+` is not allowed, bindings.${i} is not defined`);bind(r,n,s)}else{s=camelToKabob(a);void 0!==r[s]?r[s]=n:"boolean"==typeof n?n?r.setAttribute(s,""):r.removeAttribute(s):r.setAttribute(s,n)}}return r},fragment=(...e)=>{var t=globalThis.document.createDocumentFragment();for(const r of e)t.append(r);return t},_elements={fragment:fragment},elements=new Proxy(_elements,{get(e,t){if(null==(t=t.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())).match(/^\w+(-\w+)*$/))throw new Error(t+" does not appear to be a valid element tagName");return void 0===e[t]&&(e[t]=(...e)=>create(t,...e)),e[t]},set(){throw new Error("You may not add new properties to elements")}}),dimensionalProps=["left","right","top","bottom","gap"],isDimensional=e=>null!=e.match(/(width|height|size|margin|padding|radius)/)||dimensionalProps.includes(e),renderStatement=(e,t,r="")=>{var n,i=camelToKabob(e);return"object"==typeof t?(n=Object.keys(t).map(e=>renderStatement(e,t[e],r+"  ")).join("\n"),r+`  ${e} {
${n}
${r}  }`):"number"==typeof t&&isDimensional(i)?r+`  ${i}: ${t}px;`:r+`  ${i}: ${t};`},css=(n,i="")=>{return Object.keys(n).map(e=>{const t=n[e];var r=Object.keys(t).map(e=>renderStatement(e,t[e])).join("\n");return""+i+e+` {
${r}
}`}).join("\n\n")},initVars=e=>{var t={};for(const n of Object.keys(e)){var r=e[n];t["--"+camelToKabob(n)]="number"==typeof r?String(r)+"px":r}return t},vars=new Proxy({},{get(e,t){if(null==e[t]){var[,r,,n,i,s]=(t=t.replace(/[A-Z]/g,e=>"-"+e.toLocaleLowerCase())).match(/^([^\d_]*)((_)?(\d+)(\w*))?$/),r="--"+r;if(null!=i){var o=null==n?Number(i)/100:-Number(i)/100;switch(s){case"b":var a=getComputedStyle(document.body).getPropertyValue(r);e[t]=(0<o?Color.fromCss(a).brighten(o):Color.fromCss(a).darken(-o)).rgba;break;case"s":a=getComputedStyle(document.body).getPropertyValue(r);e[t]=(0<o?Color.fromCss(a).saturate(o):Color.fromCss(a).desaturate(-o)).rgba;break;case"h":a=getComputedStyle(document.body).getPropertyValue(r);e[t]=Color.fromCss(a).rotate(o).rgba;break;case"o":a=getComputedStyle(document.body).getPropertyValue(r);e[t]=Color.fromCss(a).opacity(o).rgba;break;case"":e[t]=`calc(var(${r}) * ${o})`;break;default:throw console.error(s),new Error(`Unrecognized method ${s} for css variable `+r)}}else e[t]=`var(${r})`}return e[t]}});class Component extends HTMLElement{constructor(){super(),this.content=elements.slot(),this._changeQueued=!1,this._renderQueued=!1,this._hydrated=!1,this.initAttributes("hidden"),this._value=deepClone(this.defaultValue)}static StyleNode(e){return elements.style(css(e))}static elementCreator(r){if(null==this._elementCreator){let e=null!=r?r.tag:null,t=(null!=e||(e=(e=camelToKabob(this.name)).startsWith("-")?e.substring(1):e).includes("-")||(e+="-elt"),0);for(;null==this._elementCreator;){var n=1===(t+=1)?e:e+"-"+t;try{window.customElements.define(n,this,r),this._elementCreator=elements[n]}catch(e){throw new Error(`could not define ${this.name} as <${n}>: `+String(e))}}}return this._elementCreator}initAttributes(...r){const n={},i={};new MutationObserver(e=>{let t=!1;e.forEach(e=>{t=!(!e.attributeName||!r.includes(kabobToCamel(e.attributeName)))}),t&&void 0!==this.queueRender&&this.queueRender(!1)}).observe(this,{attributes:!0}),r.forEach(t=>{n[t]=deepClone(this[t]);const r=camelToKabob(t);Object.defineProperty(this,t,{enumerable:!1,get(){return"boolean"==typeof n[t]?this.hasAttribute(r):this.hasAttribute(r)?"number"==typeof n[t]?parseFloat(this.getAttribute(r)):this.getAttribute(r):(void 0!==i[t]?i:n)[t]},set(e){"boolean"==typeof n[t]?e!==this[t]&&(e?this.setAttribute(r,""):this.removeAttribute(r),this.queueRender()):"number"==typeof n[t]?e!==parseFloat(this[t])&&(this.setAttribute(r,e),this.queueRender()):"object"!=typeof e&&""+e==""+this[t]||(null==e||"object"==typeof e?this.removeAttribute(r):this.setAttribute(r,e),this.queueRender(),i[t]=e)}})})}initValue(){var e=Object.getOwnPropertyDescriptor(this,"value");if(void 0!==e&&void 0===e.get&&void 0===e.set){let t=this.hasAttribute("value")?this.getAttribute("value"):deepClone(this.value);delete this.value,Object.defineProperty(this,"value",{enumerable:!1,get(){return t},set(e){t!==e&&(t=e,this.queueRender(!0))}})}}get refs(){const n=null!=this.shadowRoot?this.shadowRoot:this;return null==this._refs&&(this._refs=new Proxy({},{get(t,r){if(void 0===t[r]){let e=n.querySelector(`[data-ref="${r}"]`);if(null==(e=null==e?n.querySelector(r):e))throw new Error(`elementRef "${r}" does not exist!`);e.removeAttribute("data-ref"),t[r]=e}return t[r]}})),this._refs}connectedCallback(){this.hydrate(),null!=this.role&&this.setAttribute("role",this.role),void 0!==this.onResize&&(resizeObserver.observe(this),null==this._onResize&&(this._onResize=this.onResize.bind(this)),this.addEventListener("resize",this._onResize)),null!=this.value&&null!=this.getAttribute("value")&&(this._value=this.getAttribute("value"))}disconnectedCallback(){resizeObserver.unobserve(this)}queueRender(e=!1){this._changeQueued||(this._changeQueued=e),this._renderQueued||(this._renderQueued=!0,requestAnimationFrame(()=>{this._changeQueued&&dispatch(this,"change"),this._changeQueued=!1,this._renderQueued=!1,this.render()}))}hydrate(){var e;this._hydrated||(this.initValue(),void 0!==this.styleNode?((e=this.attachShadow({mode:"open"})).appendChild(this.styleNode),appendContentToElement(e,this.content)):appendContentToElement(this,this.content),this._hydrated=!0)}render(){this.hydrate()}}Component.elements=elements,exports.Color=Color,exports.Component=Component,exports.MoreMath=moreMath,exports.bind=bind,exports.bindings=bindings,exports.css=css,exports.elements=elements,exports.filter=filter,exports.getListItem=getListItem,exports.hotReload=hotReload,exports.initVars=initVars,exports.makeComponent=makeComponent,exports.matchType=matchType,exports.observe=observe,exports.observerShouldBeRemoved=observerShouldBeRemoved,exports.on=on,exports.settings=settings,exports.touch=touch,exports.typeSafe=typeSafe,exports.unobserve=unobserve,exports.useXin=useXin,exports.vars=vars,exports.xin=xin,exports.xinPath=xinPath,exports.xinValue=xinValue;
//# sourceMappingURL=cdn/index.min.js.map