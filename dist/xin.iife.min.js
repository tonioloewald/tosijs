var xi=function(t){"use strict";const e=t=>{try{return JSON.stringify(t)}catch(t){return"{has circular references}"}},f=(...t)=>new Error(t.map(e).join(" ")),s=()=>new Date(parseInt("1000000000",36)+Date.now()).valueOf().toString(36).slice(1);let r=0;const i=()=>(parseInt("10000",36)+ ++r).toString(36).substr(-5),l={},h={};function p(t){if(!t)return[];if(Array.isArray(t))return t;for(var e=[];t.length;){var r=t.search(/\[[^\]]+\]/);if(-1===r){e.push(t.split("."));break}var n=t.substr(0,r);t=t.substr(r),n&&e.push(n.split(".")),r=t.indexOf("]")+1,e.push(t.substr(1,r-2)),"."===t.substr(r,1)&&(r+=1),t=t.substr(r)}return e}const o=new WeakMap;function a(t,r){t&&!o.get(t)&&o.set(t,{}),o.get(t)[r]||(o.get(t)[r]={});const n=o.get(t)[r];return"_auto_"===r?t.forEach((t,e)=>{void 0===t._auto_&&(t._auto_=s()+i()),n[t._auto_+""]=e}):t.forEach((t,e)=>{n[u(t,r)+""]=e}),n}function c(t,e,r){r+="";s=t,i=e;let n=(o.get(s)&&o.get(s)[i]?o.get(s)[i]:a(s,i))[r];var s,i;return n=void 0!==n&&u(t[n],e)+""===r?n:a(t,e)[r]}function y(t,e,r,n){let s=e?c(t,e,r):r;if(n===l)return t.splice(s,1),o.delete(t),Symbol("deleted");if(n===h)e||t[s]||(t[s]={});else if(n)if(void 0!==s)t[s]=n;else{if(!e||u(n,e)+""!=r+"")throw new Error(`byIdPath insert failed at [${e}=${r}]`);t.push(n),s=t.length-1}return t[s]}function d(t){if(!Array.isArray(t))throw f("setByPath failed: expected array, found",t)}function g(t){if(!t||t.constructor!==Object)throw f("setByPath failed: expected Object, found",t)}function u(t,e){for(var r,n,s=p(e),i=t,o=0,a=s.length;i&&o<a;o++){var c,f,u=s[o];if(Array.isArray(u))for(r=0,n=u.length;i&&r<n;r++)i=i[u[r]];else if(i.length)i=-1<u.indexOf("=")?([c,...f]=u.split("="),y(i,c,f.join("="))):i[r=parseInt(u,10)];else{if("="!==u[0])return;i=i[u.substr(1)]}}return i}const n=Symbol("observer should be removed"),b=["sort","splice","copyWithin","fill","pop","push","reverse","shift","unshift"],v={},w=[],m=/^\.?([^.[\](),])+(\.[^.[\](),]+|\[\mad+\]|\[[^=[\](),]*=[^[\]()]+\])*$/;class ${constructor(e,r){if("string"==typeof e)this.test=t=>"string"==typeof t&&t.startsWith(e);else if(e instanceof RegExp)this.test=e.test.bind(e);else{if(!(e instanceof Function))throw new Error("expect listener test to be a string, RegExp, or test function");this.test=e}if("string"==typeof r)this.callback=(...t)=>{var e=E[r];if(!e)throw new Error(`callback path ${r} does not exist`);e(...t)};else{if("function"!=typeof r)throw new Error("expect callback to be a path or function");this.callback=r}w.push(this)}}const x=r=>{w.filter(t=>{let e;try{e=t.test(r)}catch(t){throw new Error(`listener test (${r}) threw `+t)}return e===n?(O(t),!1):!!e}).forEach(t=>{try{t.callback(r)===n&&O(t)}catch(t){throw new Error(`listener callback threw ${t} handling `+r)}})};const O=t=>{t=w.indexOf(t);if(-1<t)return w.splice(t,1),!1;throw new Error("unobserve failed, listener not found")},j=(t="",e="")=>""===t?e:e.match(/^\d+$/)||e.includes("=")?t+`[${e}]`:t+"."+e,A=(a="")=>({get(e,r){var t,n,s=r.match(/^([^.[]+)\.(.+)$/)||r.match(/^([^\]]+)(\[.+)/)||r.match(/^(\[[^\]]+\])\.(.+)$/)||r.match(/^(\[[^\]]+\])\[(.+)$/);if(s)return[,s,t]=s,n=j(a,s),(s=u(e,s))&&"object"==typeof s?new Proxy(s,A(n))[t]:s;if("_xinPath"===r)return a;if("_xinValue"===r)return e;if(r.startsWith("[")&&r.endsWith("]")&&(r=r.substr(1,r.length-2)),Object.prototype.hasOwnProperty.call(e,r)||Array.isArray(e)&&"string"==typeof r&&r.includes("=")){let t;if(r.includes("=")){const[i,o]=r.split("=");t=e.find(t=>""+u(t,i)===o)}else t=e[r];return!t||"object"!=typeof t||t.constructor!==Object&&t.constructor!==Array?"function"==typeof t?t.bind(e):t:(n=j(a,r),new Proxy(t,A(n)))}return Array.isArray(e)?"function"==typeof e[r]?(...t)=>{t=Array.prototype[r].apply(e,t);return b.includes(r)&&x(a),t}:e[Number(r)]:void 0},set(t,e,r){if(r&&r._xinPath)throw new Error("You cannot put xin proxies into the registry");var n,e=j(a,e);if(n=e,m.test(n))return function(t,e,r){let n=t;for(var s,i,o=p(e);n&&o.length;){var a=o.shift();if("string"==typeof a){var c=a.indexOf("=");if(-1<c){(0===c?g:d)(n);var f=a.substr(0,c),c=a.substr(c+1);if(n=y(n,f,c,o.length?h:r),!o.length)return 1}else{d(n);f=parseInt(a,10);if(!o.length){if(r!==l){if(n[f]===r)return;n[f]=r}else n.splice(f,1);return 1}n=n[f]}}else{if(!Array.isArray(a)||!a.length)throw new Error("setByPath failed, bad path "+e);for(g(n);a.length;){var u=a.shift();if(!a.length&&!o.length){if(r!==l){if(n[u]===r)return;n[u]=r}else{if(!n.hasOwnProperty(u))return;delete n[u]}return 1}n=(s=n,u=u,i=a.length?{}:[],s[u]||(s[u]=i),s[u])}}}throw new Error(`setByPath(${t}, ${e}, ${r}) failed`)}(v,e,r)&&x(e),!0;throw new Error("setting invalid path "+e)}}),E=new Proxy(v,A()),P=t=>null===t?"null":Array.isArray(t)?"array":"number"==typeof t&&isNaN(t)?"NaN":"string"==typeof t&&t.startsWith("#")?t:t instanceof Promise?"promise":"function"==typeof t?t.constructor===(async()=>{}).constructor?"async":"function":"object"==typeof t&&"Object"!==t.constructor.name?t.constructor.name:typeof t,k=t=>"-∞"===t?-1/0:"∞"===t[0]?1/0:parseFloat(t),S=(e,t)=>{let r,n;if(void 0!==e){try{[,r,n]=(e||"").match(/^([[(]-?[\d.\u221E]+)?,?(-?[\d.\u221E]+[\])])?$/)}catch(t){throw new Error("bad range "+e)}if(r){e=k(r.substr(1));if("("===r[0]){if(t<=e)return!1}else if(t<e)return!1}if(n){e=k(n);if(n.endsWith(")")){if(e<=t)return!1}else if(e<t)return!1}}return!0},N={},_=(t,e)=>{var[,r,n,,s]=t.match(/^#([?]?)([^\s]+)(\s(.*))?$/)||[];if(r&&null==e)return!0;var i,o=P(e);switch(n){case"forbidden":return!1;case"any":return null!=e;case"native":return"function"!=typeof e||"function () { [native code] }"!==e.toString()?!1:!t||((i=e)&&i.constructor===(async()=>{}).constructor?t.match(/^async\b/):t.match(/^function\b/));case"function":return"function"!==o?!1:!0;case"number":return"number"!==o?!1:S(s,e);case"int":return"number"!==o||e!==Math.floor(e)?!1:S(s,e);case"union":return!!s.split("||").find(t=>_("#"+t,e));case"enum":try{return s.split("|").map(JSON.parse).includes(e)}catch(t){throw new Error(`bad enum specification (${s}), expect JSON strings`)}case"void":return"undefined"===o||"null"===o;case"nothing":return"undefined"===o;case"string":return"string"===o;case"regexp":return"string"===o&&(i=s,a=e,(N[i]||(N[i]=new RegExp(i))).test(a));case"array":return Array.isArray(e);case"instance":var a=e,c=s;if("function"==typeof c)return a instanceof Function;{let t=Object.getPrototypeOf(a);for(;t.constructor&&t.constructor!==Object;){if(t.constructor.name===c)return!0;t=Object.getPrototypeOf(t)}return!1}case"promise":return e instanceof Promise;case"object":return!!e&&"object"==typeof e&&!Array.isArray(e);default:if(o!==n)throw f("got",e,`expected "${t}", "${o}" does not match "${n}"`);return!0}},R=t=>"string"==typeof t?`"${t}"`:"object"==typeof t?P(t):t;const W=(e,t,r=[],n="")=>{var s=P(e),i=P(t);if(s.startsWith("#")?_(s,t):s===i)if("array"===s){i=!!t.length&&function*(t){let e=0;for(var r=Math.ceil(t.length/101);e<t.length;)e<5||e>t.length-5?(yield{sample:t[e],i:e},e++):(yield{sample:t[e],i:e},e=Math.min(e+r,t.length-4))}(t);if(1===e.length&&i)for(var{sample:o,i:a}of i)W(e[0],o,r,`${n}[${a}]`);else if(1<e.length&&i)for(var{sample:c,i:f}of i){let t=!1;for(const u of e)if(0===W(u,c,[],"").length){t=!0;break}t||r.push(`${n}[${f}] had no matching type`)}}else"object"===s&&M(e,t,r,n);else r.push(`${n?n+" ":""}was ${R(t)}, expected `+s);return r},J=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/,M=(t,r,n=[],s="")=>{var i=new Set;for(const a of Object.keys(t))if(a.startsWith("#")){let e=J;try{"#"!==a&&(e=new RegExp(`^${a.substr(1)}$`))}catch(t){var o=`illegal regular expression in example key '${a}'`;throw n.push(o),f(o)}for(const c of Object.keys(r).filter(t=>e.test(t)))i.has(c)||(W(t[a],r[c],n,`${s}./^${a.substr(1)}$/:`+c),i.add(c))}else a.endsWith("?")?(o=a.substr(0,a.length-1),Object.hasOwnProperty.call(r,o)&&!i.has(o)&&(W(t[a],r[o],n,s+"."+o),i.add(o))):i.has(a)||(W(t[a],r[a],n,s+"."+a),i.add(a));return n};class F{constructor(t){this.functionName=void 0,this.isParamFailure=!1,this.errors=[],Object.assign(this,t)}toString(){var{functionName:t,isParamFailure:e,errors:r}=this;return t+` failed: bad ${e?"parameter":"result"}, `+JSON.stringify(r)}}const B=(t,r)=>{for(let t=0;t<r.length;t++)if(r[t]instanceof F)return r[t];t=t.map((t,e)=>W(t,r[e]));return t.flat().length?t:[]};const I=(t,e)=>{if(null!=e&&("object"==typeof e||!W(t,e).length))if(Array.isArray(t)){var r=t,n=e;if(Array.isArray(n)){if(0===r.length)return[...n];var s=[];for(const u of n){var i=r.find(t=>0===W(t,u).length);void 0!==i&&s.push(I(i,u))}return s}}else{if("object"!=typeof t)return W(e,t).length?void 0:e;var o=t,a=e;if(!W(o,a).length){var c={};for(const l of Object.keys(o)){var f=I(o[l],a[l]);void 0!==f&&(c[l]=f)}return c}}};return t.filter=I,t.matchType=W,t.observe=(t,e)=>new $(t,e),t.observerShouldBeRemoved=n,t.typeSafe=(s,i=[],o=void 0,a=void 0)=>{if(B(["#function","#?array","#?any","#?string"],[s,i,o,a])instanceof F)throw new Error("typeSafe was passed bad paramters");a=a||s.name||"anonymous";let c=0;var t=function(...t){c+=1;var e,r,n=B(i,t);return n instanceof F?n:0===n.length?(e=s(...t),0===(r=W(o,e)).length?e:new F({functionName:a,isParamFailure:!1,expected:o,found:e,errors:r})):new F({functionName:a,isParamFailure:!0,expected:i,found:t,errors:n})},e={paramTypes:i,resultType:o,getCallCount:()=>c};e={...e};for(const r of Object.keys(e)){const n=e[r];Object.defineProperty(t,r,{enumerable:!0,get(){return n},set(t){throw new Error(r+" is read-only")}})}return t},t.unobserve=O,t.xin=E,t}({});
//# sourceMappingURL=dist/xin.iife.min.js.map